<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—É–±–ª–∏–∫–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ - –î–∑–µ–Ω –≤–µ—Ä—Å–∏—è (–£–ª—É—á—à–µ–Ω–Ω—ã–π)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        .editor-section {
            padding: 30px;
            border-right: 1px solid #e0e0e0;
        }

        .preview-section {
            padding: 30px;
            background: #f8f9fa;
        }

        .section-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .file-upload {
            margin-bottom: 20px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .file-input-wrapper:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .file-input-wrapper input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        textarea {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-zen {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .preview-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            font-family: 'Times New Roman', Times, serif;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
        }

        .preview-content figure {
            margin: 20px 0;
            text-align: center;
        }

        .preview-content img {
            max-width: 100%;
            height: auto;
            border-radius: 0;
            margin: 0 auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –≤–Ω—É—Ç—Ä–∏ figure */
            box-shadow: none;
            display: block;
        }

        .preview-content p {
            margin: 16px 0;
            text-align: left;
        }

        .preview-content figcaption {
            font-style: italic;
            color: #666;
            text-align: center;
            margin: 8px 0 0 0; /* –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
            font-size: 14px;
            font-family: 'Times New Roman', Times, serif;
        }

        .help-text {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .help-text strong {
            color: #1976d2;
        }

        .zen-help {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .zen-help strong {
            color: #28a745;
        }

        .images-list {
            margin-top: 15px;
        }

        .image-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 6px;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .image-item img {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 10px;
        }

        .publish-section {
            grid-column: 1 / -1;
            padding: 30px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            text-align: center;
        }

        .publish-url {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .editor-section {
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .copy-success {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
            display: none;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è GitHub –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ */
        .github-settings {
            background: #f8f9fa;
            border-left: 4px solid #333;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .github-settings strong {
            color: #333;
        }

        /* –£–¥–∞–ª—è–µ–º .image-container, —Ç.–∫. –∏—Å–ø–æ–ª—å–∑—É–µ–º figure */
        /* .image-container { ... } */

        /* –°—Ç–∏–ª–∏ –¥–ª—è figcaption —É–∂–µ –µ—Å—Ç—å –≤—ã—à–µ */

        details {
            border: 1px solid #eee; /* Lighter border for details */
            border-radius: 8px;
            margin-bottom: 15px; /* Adjusted margin */
            background: rgba(255,255,255,0.02);
        }
        details[open] {
            background: rgba(255,255,255,0.05);
        }
        summary {
            padding: 12px 15px; /* Adjusted padding */
            cursor: pointer;
            font-weight: 600;
            outline: none;
            list-style-position: inside; 
            color: #333; /* Ensure summary text is dark enough */
        }
        summary::marker { /* Styling for the arrow */
            color: #4facfe; 
        }
        .help-text-content, .zen-help-content, .github-settings-content {
            padding: 0 15px 15px 15px;
            font-size: 0.9em;
            line-height: 1.5;
            color: #333; /* Ensure content text is dark enough */
        }
        .help-text-content code {
             background-color: rgba(0,0,0,0.07); /* Slightly darker code background */
             padding: 2px 5px;
             border-radius: 4px;
             font-family: 'Courier New', monospace;
        }
        
        /* Notification container for aria-live */
        #notification-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column-reverse; /* New notifications appear on top */
            gap: 10px;
        }
        .custom-notification {
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            max-width: 320px; /* Max width for notifications */
            word-break: break-word;
            opacity: 0.95;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .custom-notification.success {
            background-color: #d4edda; color: #155724; border-left: 4px solid #28a745;
        }
        .custom-notification.error {
            background-color: #f8d7da; color: #721c24; border-left: 4px solid #dc3545;
        }
        .custom-notification.info {
            background-color: #e3f2fd; color: #0c5460; border-left: 4px solid #17a2b8;
        }
        .custom-notification.confirm {
            background-color: #fff3cd; color: #856404; border-left: 4px solid #ffc107;
        }
        .notification-buttons {
            margin-top: 10px;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }
        .notification-buttons button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        .notification-buttons .confirm-yes {
            background-color: #28a745; color: white;
        }
        .notification-buttons .confirm-no {
            background-color: #dc3545; color: white;
        }
        .notification-buttons .confirm-cancel {
            background-color: #6c757d; color: white;
        }

    </style>
</head>
<body>
    <div id="notification-container" aria-live="assertive" aria-atomic="true"></div>

    <div class="container">
        <header class="header" role="banner">
            <h1>üìù –ü—É–±–ª–∏–∫–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–î–∑–µ–Ω –≤–µ—Ä—Å–∏—è)</h1>
            <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç —Å –ø–æ–ª–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é —Å –Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω–æ–º</p>
        </header>

        <main class="main-content" role="main">
            <section class="editor-section" role="region" aria-labelledby="editor-title">
                <h2 class="section-title" id="editor-title">–†–µ–¥–∞–∫—Ç–æ—Ä</h2>

                <div class="zen-help">
                    <details>
                        <summary>üéØ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω–∞!</summary>
                        <div class="zen-help-content">
                        –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è HTML, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º –î–∑–µ–Ω–∞. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –ø–æ–¥–ø–∏—Å–∏ –∫ –Ω–∏–º –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
                        </div>
                    </details>
                </div>

                <div class="github-settings">
                     <details>
                        <summary>‚öôÔ∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitHub!</summary>
                        <div class="github-settings-content">
                        –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å–≤–æ–π GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –∏–º–∏ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É.
                        </div>
                    </details>
                </div>

                <div class="help-text">
                    <details open> <!-- Keep this one open by default for critical instructions -->
                        <summary>üí° –§–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏</summary>
                        <div class="help-text-content">
                        <code>[IMG:–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ñ–∞–π–ª–∞.jpg] –ø–æ–¥–ø–∏—Å—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é</code> - –¥–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤<br>
                        <code>[URL:https://example.com/image.jpg] –ø–æ–¥–ø–∏—Å—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é</code> - –¥–ª—è –æ–Ω–ª–∞–π–Ω –∫–∞—Ä—Ç–∏–Ω–æ–∫<br><br>
                        <strong>–ü—Ä–∏–º–µ—Ä—ã:</strong><br>
                        <code>[IMG:photo1.jpg] –ö—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –º–æ—Ä–µ–º</code><br>
                        <code>[URL:https://picsum.photos/600/400] –°–ª—É—á–∞–π–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</code>
                        <br><br>
                        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–≤–æ–π–Ω–æ–π –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∞–±–∑–∞—Ü–∞.
                        </div>
                    </details>
                </div>

                <div class="file-upload">
                    <div class="file-input-wrapper">
                        <input type="file" id="textFile" accept=".txt" aria-label="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª">
                        üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ–∫—Å—Ç (.txt)
                    </div>

                    <div class="file-input-wrapper">
                        <input type="file" id="imageFiles" multiple accept="image/*" aria-label="–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
                        üñºÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    </div>
                     <div class="file-input-wrapper" id="manageGitHubImagesBtnContainer" style="display: none;">
                        <button class="btn btn-secondary" onclick="openManageGitHubImagesModal()" aria-label="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –Ω–∞ GitHub">üñºÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (GitHub)</button>
                    </div>
                </div>

                <div class="images-list" id="imagesList" aria-live="polite"></div>

                <textarea id="textEditor" aria-label="–¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª...

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –º–æ–π —Å–∞–π—Ç!

[IMG:photo1.jpg] –≠—Ç–æ –º–æ—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è

–ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–π —Ç–µ–∫—Å—Ç...

[URL:https://picsum.photos/600/400] –ê —ç—Ç–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

–ï—â–µ —Ç–µ–∫—Å—Ç...

[URL:https://images.unsplash.com/photo-1506905925346-21bda4d32df4] –ö—Ä–∞—Å–∏–≤—ã–π –ø–µ–π–∑–∞–∂ —Å Unsplash"></textarea>

                <div>
                    <button class="btn" onclick="generatePreview()" aria-label="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä">üëÅÔ∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                    <button class="btn btn-secondary" onclick="clearAll()" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>

                <div class="copy-success" id="copySuccess" aria-live="polite">
                    ‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –¥–ª—è –î–∑–µ–Ω–∞!
                </div>
            </section>

            <aside class="preview-section" role="region" aria-labelledby="preview-title">
                <h2 class="section-title" id="preview-title">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
                <div class="preview-content" id="previewContent" aria-live="polite">
                    <p style="text-align: center; color: #999; font-style: italic;">
                        –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä"
                    </p>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-zen" onclick="copyForZenWithGitHub()" id="zenCopyBtn" aria-label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –î–∑–µ–Ω–∞">
                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –î–∑–µ–Ω–∞
                    </button>
                </div>
            </aside>
        </main>

        <section class="publish-section" role="region" aria-labelledby="publish-title">
            <h2 id="publish-title">üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è</h2>
            <p>–í–∞—à –∫–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –ø—Ä—è–º–æ –∑–¥–µ—Å—å –≤ —ç—Ç–æ–º –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–µ</p>

            <div class="loading" id="loading" aria-live="assertive">
                <div class="spinner"></div>
                <p>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏...</p>
            </div>

            <button class="btn" onclick="publishContent()" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); font-size: 18px; padding: 15px 30px;" aria-label="–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∑–¥–µ—Å—å">
                üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∑–¥–µ—Å—å
            </button>

            <div id="publishResult" aria-live="polite"></div>

            <!-- –û–±–ª–∞—Å—Ç—å –¥–ª—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
            <div id="publishedContent" style="display: none;" aria-live="polite">
                <div style="border-top: 3px solid #4facfe; margin-top: 30px; padding-top: 30px;">
                    <h2 style="text-align: center; color: white; margin-bottom: 20px;">üìÑ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:</h2>
                    <div style="background: white; border-radius: 10px; padding: 30px; color: #333; max-height: 600px; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                        <div id="finalContent" aria-live="polite" style="
                            font-family: 'Times New Roman', Times, serif;
                            font-size: 16px;
                            line-height: 1.6;
                            color: #333;
                            max-width: 100%;
                        "></div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" onclick="downloadCurrentPage()">üíæ –°–∫–∞—á–∞—Ç—å HTML</button>
                        <button class="btn btn-secondary" onclick="copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å HTML</button>
                        <button class="btn btn-zen" onclick="copyForZenWithGitHub()" id="zenCopyBtn2">üìÑ –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –î–∑–µ–Ω–∞</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GitHub
        const githubConfig = {
            // –≠—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            owner: '', // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è GitHub
            repo: '', // –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
            branch: 'main', // –í–µ—Ç–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            token: '', // –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ GitHub
            imagesPath: 'images/' // –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
        };

        let uploadedImages = new Map();
        let processedContent = '';
        let imageUrlMap = new Map(); // –ú–∞–ø–ø–∏–Ω–≥ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–µ URL

        // –°–∏–º—É–ª—è—Ü–∏—è CDN URL –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–≤ —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π CDN)
        function generatePublicImageUrl(filename, dataUrl) {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const imageId = 'img_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É CDN/—Å–µ—Ä–≤–µ—Ä—É
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º imgbb.com API –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–π —Å–µ—Ä–≤–∏—Å

            // –í—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º data URL, –Ω–æ —Å –º–∞—Ä–∫–µ—Ä–æ–º –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∑–∞–º–µ–Ω—ã
            const publicUrl = `https://cdn.publikator.demo/${imageId}/${filename}`;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            imageUrlMap.set(filename, {
                publicUrl: publicUrl,
                dataUrl: dataUrl,
                filename: filename
            });

            return publicUrl;
        }

        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ data URL –≤ blob URL –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        function dataUrlToBlobUrl(dataUrl) {
            const arr = dataUrl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while(n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            const blob = new Blob([u8arr], {type: mime});
            return URL.createObjectURL(blob);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
        document.getElementById('textFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('textEditor').value = e.target.result;
                };
                reader.readAsText(file, 'utf-8');
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        document.getElementById('imageFiles').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const imagesList = document.getElementById('imagesList');

            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImages.set(file.name, e.target.result);
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π URL –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    generatePublicImageUrl(file.name, e.target.result);
                    updateImagesList();
                };
                reader.readAsDataURL(file);
            });
        });

        function updateImagesList() {
            const imagesList = document.getElementById('imagesList');
            imagesList.innerHTML = '';

            if (uploadedImages.size > 0) {
                const title = document.createElement('div');
                title.innerHTML = '<strong>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</strong>';
                imagesList.appendChild(title);

                uploadedImages.forEach((dataUrl, filename) => {
                    const item = document.createElement('div');
                    item.className = 'image-item';
                    item.innerHTML = `
                        <img src="${dataUrl}" alt="${filename}" />
                        <span>${filename}</span>
                    `;
                    imagesList.appendChild(item);
                });
            }
        }

        function generatePreview() {
            const text = document.getElementById('textEditor').value;
            const previewContent = document.getElementById('previewContent');

            if (!text.trim()) {
                previewContent.innerHTML = '<p style="color: #999;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç</p>';
                return;
            }

            let processedText = text;

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π [IMG:]
            const imageRegex = /\[IMG:([^\]]+)\]\s*([^
]*)/g;
            processedText = processedText.replace(imageRegex, (match, filename, caption) => {
                const imageData = uploadedImages.get(filename);
                if (imageData) {
                    const captionHtml = caption ? `<figcaption>${caption.trim()}</figcaption>` : '';
                    return `<figure><img src="${imageData}" alt="${caption}" />${captionHtml}</figure>`;
                } else {
                    return `<div style="background: #ffebee; color: #c62828; padding: 10px; border-radius: 5px; margin: 10px 0;">‚ö†Ô∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ "${filename}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`;
                }
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–Ω–ª–∞–π–Ω –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π [URL:]
            const urlRegex = /\[URL:([^\]]+)\]\s*([^
]*)/g;
            processedText = processedText.replace(urlRegex, (match, imageUrl, caption) => {
                const captionHtml = caption ? `<figcaption>${caption.trim()}</figcaption>` : '';
                const errorDiv = `<div style="display: none; background: #ffebee; color: #c62828; padding: 10px; border-radius: 5px; margin: 10px 0;">‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${imageUrl}</div>`;
                return `<figure><img src="${imageUrl}" alt="${caption}" onload="this.style.opacity='1'" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'" style="opacity: 0.5; transition: opacity 0.3s;" />${errorDiv}${captionHtml}</figure>`;
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–±–∑–∞—Ü–µ–≤
            processedText = processedText.split('

').map(paragraph => {
                if (paragraph.trim() && !paragraph.includes('<figure') && !paragraph.includes('<div')) { // –ù–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –±–ª–æ–∫–∏ —Å figure –∏–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏ –≤ <p>
                    return `<p>${paragraph.trim().replace(/
/g, '<br>')}</p>`;
                }
                return paragraph; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å, –µ—Å–ª–∏ —ç—Ç–æ —É–∂–µ HTML-–±–ª–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
            }).join('
'); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã

            previewContent.innerHTML = processedText;
            processedContent = processedText; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π HTML –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub
        function setupGitHub() {
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.style.zIndex = '9999';

            const modalContent = document.createElement('div');
            modalContent.style.backgroundColor = 'white';
            modalContent.style.padding = '30px';
            modalContent.style.borderRadius = '10px';
            modalContent.style.width = '500px';
            modalContent.style.maxWidth = '90%';
            modalContent.style.maxHeight = '90%';
            modalContent.style.overflowY = 'auto';

            modalContent.innerHTML = `
                <h2 style="margin-top: 0; color: #4facfe;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å GitHub</h2>
                <p>–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ GitHub, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:</p>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è GitHub:</label>
                    <input type="text" id="github-owner" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" 
                        value="${githubConfig.owner}" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, username">
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:</label>
                    <input type="text" id="github-repo" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" 
                        value="${githubConfig.repo}" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, my-blog-images">
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">–í–µ—Ç–∫–∞:</label>
                    <input type="text" id="github-branch" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" 
                        value="${githubConfig.branch}" placeholder="main">
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞:</label>
                    <input type="password" id="github-token" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" 
                        value="${githubConfig.token}" placeholder="ghp_xxxxxxxxxxxx">
                    <p style="font-size: 0.8em; color: #666; margin-top: 5px;">
                        <a href="https://github.com/settings/tokens" target="_blank" style="color: #4facfe;">–°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω</a> 
                        —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é (repo).
                    </p>
                </div>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">–ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏:</label>
                    <input type="text" id="github-images-path" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" 
                        value="${githubConfig.imagesPath}" placeholder="e.g., images/articles/">
                    <p style="font-size: 0.8em; color: #666; margin-top: 5px;">
                        –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (e.g., images/ –∏–ª–∏ my-docs/assets/). <strong>–í–∞–∂–Ω–æ: –ø—É—Ç—å –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ /</strong>
                    </p>
                </div>

                <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                    <button id="github-cancel" style="padding: 10px 15px; margin-right: 10px; border: none; border-radius: 5px; 
                        background-color: #f1f1f1; cursor: pointer;">–û—Ç–º–µ–Ω–∞</button>
                    <button id="github-save" style="padding: 10px 15px; border: none; border-radius: 5px; 
                        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; cursor: pointer;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('github-cancel').addEventListener('click', () => {
                document.body.removeChild(modal);
            });

            document.getElementById('github-save').addEventListener('click', () => {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                githubConfig.owner = document.getElementById('github-owner').value.trim();
                githubConfig.repo = document.getElementById('github-repo').value.trim();
                githubConfig.branch = document.getElementById('github-branch').value.trim() || 'main';
                githubConfig.token = document.getElementById('github-token').value.trim();
                githubConfig.imagesPath = document.getElementById('github-images-path').value.trim();

            // –î–æ–±–∞–≤–ª—è–µ–º / –≤ –∫–æ–Ω–µ—Ü –ø—É—Ç–∏, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ "/"
            if (githubConfig.imagesPath && githubConfig.imagesPath !== '/' && !githubConfig.imagesPath.endsWith('/')) {
                    githubConfig.imagesPath += '/';
                }
            if (githubConfig.imagesPath === '/') { // Prevent using root as imagesPath if accidentally entered
                githubConfig.imagesPath = 'images/'; 
                showNotification('–ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ—Ä–Ω–µ–≤—ã–º. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—É—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: images/', 'error');
            }

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ localStorage
                localStorage.setItem('githubConfig', JSON.stringify({
                    owner: githubConfig.owner,
                    repo: githubConfig.repo,
                    branch: githubConfig.branch,
                    imagesPath: githubConfig.imagesPath
                    // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ localStorage –ø–æ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                }));

                document.body.removeChild(modal);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –∏ –Ω–∞—á–∏–Ω–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é
                showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...', 'info');
                validateGitHubConfig(); 
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ GitHub –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function validateGitHubConfig(showSuccessNotification = true) { // Added parameter
            const manageImagesBtnContainer = document.getElementById('manageGitHubImagesBtnContainer');

            if (!githubConfig.owner || !githubConfig.repo) {
                if (showSuccessNotification) showNotification('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π GitHub –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–∫–∞–∑–∞–Ω—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏.', 'error');
                if (manageImagesBtnContainer) manageImagesBtnContainer.style.display = 'none';
                return false; // Added return
            }
            if (!githubConfig.token) {
                if (showSuccessNotification) showNotification('–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ GitHub –Ω–µ —É–∫–∞–∑–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–≥–æ.', 'error');
                if (manageImagesBtnContainer) manageImagesBtnContainer.style.display = 'none';
                return false; // Added return
            }

            const loadingIndicator = showLoadingIndicator('–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ GitHub...');
            let isValid = false; // Added flag
            try {
                const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}`, {
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                hideLoadingIndicator(loadingIndicator);

                if (response.ok) { // Status 200-299
                    if (showSuccessNotification) showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã! –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.', 'success');
                    if (manageImagesBtnContainer) manageImagesBtnContainer.style.display = 'inline-block'; // Show manage button
                    isValid = true;
                } else if (response.status === 401) {
                    if (showSuccessNotification) showNotification('–ü—Ä–æ–≤–µ—Ä–∫–∞ GitHub –ø—Ä–æ–≤–∞–ª–µ–Ω–∞: –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω.', 'error');
                    if (manageImagesBtnContainer) manageImagesBtnContainer.style.display = 'none';
                } else if (response.status === 403) {
                     if (showSuccessNotification) showNotification('–ü—Ä–æ–≤–µ—Ä–∫–∞ GitHub –ø—Ä–æ–≤–∞–ª–µ–Ω–∞: –¢–æ–∫–µ–Ω –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é.', 'error');
                     if (manageImagesBtnContainer) manageImagesBtnContainer.style.display = 'none';
                } else if (response.status === 404) {
                    if (showSuccessNotification) showNotification('–ü—Ä–æ–≤–µ—Ä–∫–∞ GitHub –ø—Ä–æ–≤–∞–ª–µ–Ω–∞: –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.', 'error');
                    if (manageImagesBtnContainer) manageImagesBtnContainer.style.display = 'none';
                } else {
                    if (showSuccessNotification) showNotification(`–ü—Ä–æ–≤–µ—Ä–∫–∞ GitHub –ø—Ä–æ–≤–∞–ª–µ–Ω–∞: –û—à–∏–±–∫–∞ ${response.status}. ${response.statusText}`, 'error');
                    if (manageImagesBtnContainer) manageImagesBtnContainer.style.display = 'none';
                }
            } catch (error) {
                hideLoadingIndicator(loadingIndicator);
                console.error('–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ GitHub:', error);
                if (showSuccessNotification) showNotification('–ü—Ä–æ–≤–µ—Ä–∫–∞ GitHub –ø—Ä–æ–≤–∞–ª–µ–Ω–∞: –ü—Ä–æ–∏–∑–æ—à–ª–∞ —Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –∏–ª–∏ GitHub –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.', 'error');
                if (manageImagesBtnContainer) manageImagesBtnContainer.style.display = 'none';
            }
            return isValid; // Return validation status
        }

        let currentArticleIdForManagement = null; // Store article ID for management modal

        // Function to open modal for managing GitHub Images
        function openManageGitHubImagesModal() {
            if (!currentArticleIdForManagement) {
                showNotification("ID —Å—Ç–∞—Ç—å–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –Ω–∞ GitHub —Ö–æ—Å—Ç–∏–Ω–≥ —Ö–æ—Ç—ã –±—ã —Ä–∞–∑.", "error");
                return;
            }

            const articleImages = JSON.parse(localStorage.getItem(`article_${currentArticleIdForManagement}_images`) || '[]');

            const modal = document.createElement('div');
            // Basic styling - can be enhanced
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background-color: rgba(0,0,0,0.6); display: flex; align-items: center;
                justify-content: center; z-index: 10000; padding: 20px;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background-color: white; padding: 25px; border-radius: 10px;
                width: 600px; max-width: 95%; max-height: 80vh; overflow-y: auto;
                box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            `;
            modalContent.setAttribute('role', 'dialog');
            modalContent.setAttribute('aria-labelledby', 'manage-images-title');
            modalContent.setAttribute('aria-modal', 'true');


            modalContent.innerHTML = `
                <h2 id="manage-images-title" style="margin-top: 0; color: #4facfe; margin-bottom:10px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –¥–ª—è —Å—Ç–∞—Ç—å–∏:</h2>
                <p style="font-size:0.9em; color:#555; margin-bottom:20px;">ID —Å—Ç–∞—Ç—å–∏: <strong>${currentArticleIdForManagement}</strong></p>
                <div id="githubImagesList" style="margin-bottom: 20px;"></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                    <button id="github-manage-close" class="btn btn-secondary" style="background: #6c757d;">–ó–∞–∫—Ä—ã—Ç—å</button>
                    ${articleImages.length > 0 ? `<button id="github-delete-all-article-images" class="btn" style="background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ (${articleImages.length}) —Å GitHub</button>` : ''}
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => { // Close on backdrop click
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });


            document.getElementById('github-manage-close').addEventListener('click', () => {
                document.body.removeChild(modal);
            });

            if (document.getElementById('github-delete-all-article-images')) {
                document.getElementById('github-delete-all-article-images').addEventListener('click', () => {
                    confirmAction(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï (${articleImages.length}) –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞—Ç—å–∏ ${currentArticleIdForManagement} —Å GitHub? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`, () => {
                        deleteArticleImages(currentArticleIdForManagement).then(() => {
                           if (modal.parentNode) document.body.removeChild(modal); // Close modal on success
                           showNotification(`–í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞—Ç—å–∏ ${currentArticleIdForManagement} —É–¥–∞–ª–µ–Ω—ã.`, 'success');
                        }).catch(err => {
                           showNotification(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${err.message}`, 'error');
                        });
                    });
                });
            }
            
            renderGitHubImagesList(currentArticleIdForManagement, modalContent.querySelector('#githubImagesList'));
        }

        function renderGitHubImagesList(articleId, containerElement) {
            const articleImages = JSON.parse(localStorage.getItem(`article_${articleId}_images`) || '[]');
            containerElement.innerHTML = ''; // Clear previous list

            if (articleImages.length === 0) {
                containerElement.innerHTML = '<p style="color: #777; text-align:center;">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏ –Ω–∞ GitHub.</p>';
                // Disable delete all button if no images
                const deleteAllBtn = document.getElementById('github-delete-all-article-images');
                if (deleteAllBtn) {
                    deleteAllBtn.disabled = true;
                    deleteAllBtn.style.opacity = '0.6';
                    deleteAllBtn.textContent = '–£–¥–∞–ª–∏—Ç—å –≤—Å–µ (0) —Å GitHub';
                }
                return;
            }

            const ul = document.createElement('ul');
            ul.style.cssText = 'list-style: none; padding: 0;';
            articleImages.forEach(image => {
                const li = document.createElement('li');
                li.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee;';
                
                const imgPreview = document.createElement('img');
                imgPreview.src = image.url; // Assuming image.url is the raw.githubusercontent URL
                imgPreview.alt = image.filename;
                imgPreview.style.cssText = 'width: 50px; height: 50px; object-fit: cover; border-radius: 4px; margin-right: 15px;';

                const fileNameSpan = document.createElement('span');
                fileNameSpan.textContent = image.filename;
                fileNameSpan.style.flexGrow = '1';
                fileNameSpan.style.fontSize = '0.9em';

                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = 'üóëÔ∏è';
                deleteBtn.className = 'btn';
                deleteBtn.setAttribute('aria-label', `–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${image.filename} —Å GitHub`);
                deleteBtn.title = `–£–¥–∞–ª–∏—Ç—å ${image.filename} —Å GitHub`;
                deleteBtn.style.cssText = 'background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%); padding: 5px 10px; font-size: 14px; margin-left:10px;';
                deleteBtn.onclick = () => {
                    confirmAction(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${image.filename}" —Å GitHub?`, () => {
                        deleteSingleImageFromGitHub(articleId, image.filename, image.sha)
                            .then(() => {
                                showNotification(`–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ "${image.filename}" —É–¥–∞–ª–µ–Ω–æ —Å GitHub.`, 'success');
                                renderGitHubImagesList(articleId, containerElement); // Re-render list
                                // Update the "delete all" button text/state as well
                                const deleteAllBtn = document.getElementById('github-delete-all-article-images');
                                const updatedImages = JSON.parse(localStorage.getItem(`article_${articleId}_images`) || '[]');
                                if (deleteAllBtn) {
                                    if (updatedImages.length > 0) {
                                     deleteAllBtn.textContent = `–£–¥–∞–ª–∏—Ç—å –≤—Å–µ (${updatedImages.length}) —Å GitHub`;
                                     deleteAllBtn.disabled = false;
                                     deleteAllBtn.style.opacity = '1';
                                    } else {
                                     deleteAllBtn.textContent = '–£–¥–∞–ª–∏—Ç—å –≤—Å–µ (0) —Å GitHub';
                                     deleteAllBtn.disabled = true;
                                     deleteAllBtn.style.opacity = '0.6';
                                    }
                                }
                            })
                            .catch(err => showNotification(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è "${image.filename}": ${err.message}`, 'error'));
                    });
                };

                const imageInfoDiv = document.createElement('div');
                imageInfoDiv.style.display = 'flex';
                imageInfoDiv.style.alignItems = 'center';
                imageInfoDiv.appendChild(imgPreview);
                imageInfoDiv.appendChild(fileNameSpan);
                
                li.appendChild(imageInfoDiv);
                li.appendChild(deleteBtn);
                ul.appendChild(li);
            });
            containerElement.appendChild(ul);
        }
        
        async function deleteSingleImageFromGitHub(articleId, filename, sha) {
            if (!githubConfig.owner || !githubConfig.repo || !githubConfig.token) {
                showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub –Ω–µ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω—ã.', 'error');
                throw new Error('GitHub config missing');
            }
            const imagePath = `${githubConfig.imagesPath}${articleId}/${filename}`;
            const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${imagePath}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `token ${githubConfig.token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `Delete image ${filename} for article ${articleId} via PublikaTor`,
                    sha: sha,
                    branch: githubConfig.branch
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({ message: response.statusText }));
                console.error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ${filename} —Å GitHub:`, errorData);
                throw new Error(`GitHub API: ${errorData.message || response.status}`);
            }
            
            // Update localStorage
            let articleImages = JSON.parse(localStorage.getItem(`article_${articleId}_images`) || '[]');
            articleImages = articleImages.filter(img => img.filename !== filename);
            localStorage.setItem(`article_${articleId}_images`, JSON.stringify(articleImages));
            
            return await response.json();
        }


        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ GitHub
        async function uploadImageToGitHub(dataUrl, filename, articleId) {
            currentArticleIdForManagement = articleId; // Keep track of the latest article ID used with GitHub
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub
            if (!githubConfig.owner || !githubConfig.repo || !githubConfig.token) {
                showNotification('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å GitHub. –ù–∞–∂–º–∏—Ç–µ ‚öôÔ∏è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.', 'error');
                 // Consider calling setupGitHub() here or providing a more direct way to open it.
                showNotification('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å GitHub. –ù–∞–∂–º–∏—Ç–µ ‚öôÔ∏è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.', 'error');
                // Consider calling setupGitHub() here.
                throw new Error('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å GitHub');
            }

            try {
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º dataUrl –≤ base64 –¥–ª—è GitHub API
                const base64Data = dataUrl.split(',')[1];

                // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è ID —Å—Ç–∞—Ç—å–∏
                const imagePath = `${githubConfig.imagesPath}${articleId}/${filename}`;

                // –ü–æ–ª—É—á–∞–µ–º SHA —Ñ–∞–π–ª–∞, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                let fileSha = null;
                try {
                    const fileResponse = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${imagePath}?ref=${githubConfig.branch}`, {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (fileResponse.ok) {
                        const fileData = await fileResponse.json();
                        fileSha = fileData.sha;
                    }
                } catch (error) {
                    // –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
                    console.log('–§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π');
                }

                // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–π–ª
                const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${imagePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Upload image ${filename} for article ${articleId}`,
                        content: base64Data,
                        branch: githubConfig.branch,
                        sha: fileSha
                    })
                });

                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
                saveImageInfo(articleId, filename, data.content.sha, data.content.html_url);

                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é —á–µ—Ä–µ–∑ GitHub Pages –∏–ª–∏ raw.githubusercontent.com
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º raw.githubusercontent.com –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
                return `https://raw.githubusercontent.com/${githubConfig.owner}/${githubConfig.repo}/${githubConfig.branch}/${imagePath}`;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ GitHub:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ GitHub: ' + error.message, 'error');
                throw error;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö
        function saveImageInfo(articleId, filename, sha, url) {
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Å—Ç–∞—Ç—å–∏
            let articleImages = JSON.parse(localStorage.getItem(`article_${articleId}_images`) || '[]');

            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
            articleImages.push({
                filename,
                sha,
                url,
                uploadedAt: new Date().toISOString()
            });

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
            localStorage.setItem(`article_${articleId}_images`, JSON.stringify(articleImages));
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç–∞—Ç—å–µ–π
        async function deleteArticleImages(articleId) { // This function deletes ALL images for an article
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub
            if (!githubConfig.owner || !githubConfig.repo || !githubConfig.token) {
                setupGitHub();
                throw new Error('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å GitHub');
            }

            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Å—Ç–∞—Ç—å–∏
            const articleImages = JSON.parse(localStorage.getItem(`article_${articleId}_images`) || '[]');

            if (articleImages.length === 0) {
                showNotification('–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'info');
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingIndicator = showLoadingIndicator('–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...');

            try {
                // –£–¥–∞–ª—è–µ–º –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                for (const image of articleImages) {
                    const imagePath = `${githubConfig.imagesPath}${articleId}/${image.filename}`;

                    // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
                    const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${imagePath}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Delete image ${image.filename} for article ${articleId}`,
                            sha: image.sha,
                            branch: githubConfig.branch
                        })
                    });

                    if (!response.ok) {
                        console.error(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ${image.filename}:`, await response.text());
                    }
                }

                // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Å—Ç–∞—Ç—å–∏
                localStorage.removeItem(`article_${articleId}_images`);

                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                hideLoadingIndicator(loadingIndicator);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                showNotification(`–£–¥–∞–ª–µ–Ω–æ ${articleImages.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Å—Ç–∞—Ç—å–∏ ${articleId}`, 'success');
            } catch (error) {
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                hideLoadingIndicator(loadingIndicator);

                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:', error);
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ' + error.message, 'error');
                throw error;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID —Å—Ç–∞—Ç—å–∏
        function generateArticleId() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –¥–∞—Ç—ã
            const title = document.querySelector('#previewContent h1, #previewContent h2, #previewContent h3, #previewContent p')?.textContent || '';
            const titleSlug = title.toLowerCase()
                .replace(/[^\w\s-]/g, '') // –£–¥–∞–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
                .replace(/\s+/g, '-') // –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ –¥–µ—Ñ–∏—Å—ã
                .substring(0, 30); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É

            const timestamp = Date.now().toString(36);
            return `${titleSlug}-${timestamp}`;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showNotification(message, type = 'info', duration = 5000, buttons = null) {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `custom-notification ${type}`;
            notification.textContent = message;
            
            // Add ARIA role for alerts
            if (type === 'error' || type === 'success' || type === 'info') {
                 notification.setAttribute('role', 'alert');
            }


            if (buttons) {
                const buttonsDiv = document.createElement('div');
                buttonsDiv.className = 'notification-buttons';
                buttons.forEach(btnConfig => {
                    const button = document.createElement('button');
                    button.textContent = btnConfig.text;
                    button.className = btnConfig.className;
                    button.onclick = () => {
                        btnConfig.action();
                        if (notification.parentNode === container) { // Check if still in DOM
                           container.removeChild(notification);
                        }
                    };
                    buttonsDiv.appendChild(button);
                });
                notification.appendChild(buttonsDiv);
            }

            container.insertBefore(notification, container.firstChild); // Add to top of container

            if (duration > 0) { // duration 0 or less means sticky
                setTimeout(() => {
                    if (notification.parentNode === container) { // Check if still in DOM
                         container.removeChild(notification);
                    }
                }, duration);
            }
            return notification; // Return for potential manual removal
        }

        // Confirmation Dialog using showNotification
        function confirmAction(message, onConfirm, onCancel = () => {}) {
            showNotification(message, 'confirm', 0, [ // Sticky notification (duration 0)
                { text: '–î–∞', className: 'confirm-yes', action: onConfirm },
                { text: '–û—Ç–º–µ–Ω–∞', className: 'confirm-cancel', action: onCancel }
            ]);
        }

        function showLoadingIndicator(message) {
            const loadingIndicator = document.createElement('div');
            loadingIndicator.style.position = 'fixed';
            loadingIndicator.style.top = '0';
            loadingIndicator.style.left = '0';
            loadingIndicator.style.width = '100%';
            loadingIndicator.style.height = '100%';
            loadingIndicator.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            loadingIndicator.style.display = 'flex';
            loadingIndicator.style.alignItems = 'center';
            loadingIndicator.style.justifyContent = 'center';
            loadingIndicator.style.zIndex = '9999';

            loadingIndicator.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <div class="spinner" style="border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px;"></div>
                    <p>${message}</p>
                </div>
            `;

            document.body.appendChild(loadingIndicator);
            return loadingIndicator;
        }

        function hideLoadingIndicator(loadingIndicator) {
            if (loadingIndicator && loadingIndicator.parentNode) {
                loadingIndicator.parentNode.removeChild(loadingIndicator);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ copyForZen —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GitHub
        async function copyForZenWithGitHub() {
            if (!processedContent) {
                // –ï—Å–ª–∏ –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –ø—ã—Ç–∞–µ–º—Å—è –µ–≥–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
                generatePreview();
                if (!processedContent) { // –ï—Å–ª–∏ –∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–µ—Ç, —Ç–æ –≤—ã—Ö–æ–¥–∏–º
                    showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä!', 'error');
                    return;
                }
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID —Å—Ç–∞—Ç—å–∏
            const articleId = generateArticleId();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingIndicator = showLoadingIndicator('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –î–∑–µ–Ω–∞...');

            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π div –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å DOM
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = processedContent; // –ë–µ—Ä–µ–º HTML –∏–∑ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞

            // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–º–∏—Å–æ–≤ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            const uploadPromises = [];

            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ <figure> —ç–ª–µ–º–µ–Ω—Ç—ã –≤ tempDiv
            const figureElements = tempDiv.querySelectorAll('figure');

            for (const figure of figureElements) {
                const imgElement = figure.querySelector('img');
                const figcaptionElement = figure.querySelector('figcaption');
                const caption = figcaptionElement ? figcaptionElement.textContent : '';

                if (!imgElement) continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ –Ω–µ—Ç img

                const originalSrc = imgElement.getAttribute('src');
                const isLocalImage = originalSrc.startsWith('data:image');
                const isOnlineImage = originalSrc.startsWith('http');

                if (isLocalImage) {
                    // –ù–∞—Ö–æ–¥–∏–º –∏–º—è —Ñ–∞–π–ª–∞ –ø–æ dataUrl
                    let filename = null;
                    for (const [key, value] of uploadedImages.entries()) {
                        if (value === originalSrc) {
                            filename = key;
                            break;
                        }
                    }

                    if (filename) {
                        // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–º–∏—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ GitHub
                        const uploadPromise = uploadImageToGitHub(originalSrc, filename, articleId)
                            .then(publicUrl => {
                                // –ó–∞–º–µ–Ω—è–µ–º src –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π URL
                                imgElement.src = publicUrl;

                                // –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã –∫–∞–∫ –≤ Google Docs
                                imgElement.setAttribute('width', '100%');
                                imgElement.setAttribute('height', 'auto');
                                imgElement.setAttribute('data-original-src', filename);
                                imgElement.setAttribute('data-article-id', articleId);

                                // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã
                                imgElement.removeAttribute('style');
                                imgElement.removeAttribute('onload');
                                imgElement.removeAttribute('onerror');
                            })
                            .catch(error => {
                                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
                                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º dataUrl
                            });

                        uploadPromises.push(uploadPromise);
                    }
                } else if (isOnlineImage) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã –∫–∞–∫ –≤ Google Docs
                    imgElement.setAttribute('width', '100%');
                    imgElement.setAttribute('height', 'auto');
                    imgElement.setAttribute('data-original-src', originalSrc);
                    imgElement.setAttribute('data-article-id', articleId);

                    // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã
                    imgElement.removeAttribute('style');
                    imgElement.removeAttribute('onload');
                    imgElement.removeAttribute('onerror');

                    // –£–¥–∞–ª—è–µ–º div —Å –æ—à–∏–±–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                    const errorDiv = imgElement.nextElementSibling;
                    if (errorDiv && errorDiv.tagName === 'DIV' && errorDiv.style.display === 'none') {
                        errorDiv.remove();
                    }
                }
            }

            // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∑–æ–∫
            Promise.all(uploadPromises)
                .then(() => {
                    // –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π HTML
                    let zenHtml = tempDiv.innerHTML;

                    // –û—á–∏—â–∞–µ–º HTML –æ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –î–∑–µ–Ω –º–æ–∂–µ—Ç –Ω–µ –ø–æ–Ω—è—Ç—å
                    // –ù–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∞–∂–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É figure/figcaption
                    zenHtml = zenHtml.replace(/style="[^"]*"/g, function(match) {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                        if (match.includes('text-align') || match.includes('font-style') || 
                            match.includes('color') || match.includes('font-size')) {
                            return match;
                        }
                        return '';
                    });

                    zenHtml = zenHtml.replace(/onload="[^"]*"/g, '');
                    zenHtml = zenHtml.replace(/onerror="[^"]*"/g, '');
                    zenHtml = zenHtml.replace(/<div style="display: none; background:[^>]+>.*?<\/div>/g, '');

                    // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã –∏ –ø—Ä–æ–±–µ–ª—ã
                    zenHtml = zenHtml.replace(/
\s*
/g, '
');
                    zenHtml = zenHtml.trim();

                    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
                    copyHtmlToClipboard(zenHtml);

                    // –£–¥–∞–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                    hideLoadingIndicator(loadingIndicator);

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                    showNotification(`–ö–æ–Ω—Ç–µ–Ω—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –¥–ª—è –î–∑–µ–Ω–∞! ID —Å—Ç–∞—Ç—å–∏: ${articleId}`, 'success');

                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                    addDeleteImagesButton(articleId);
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:', error);
                    hideLoadingIndicator(loadingIndicator);
                    showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', 'error');
                });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function addDeleteImagesButton(articleId) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
            if (document.getElementById(`delete-images-${articleId}`)) {
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É
            const deleteButton = document.createElement('button');
            deleteButton.id = `delete-images-${articleId}`;
            deleteButton.className = 'btn';
            deleteButton.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%)';
            deleteButton.style.marginLeft = '10px';
            deleteButton.innerHTML = 'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—å–∏';
            deleteButton.title = `–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞—Ç—å–∏ ${articleId}`;

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è
            deleteButton.addEventListener('click', () => {
                confirmAction(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞—Ç—å–∏ ${articleId}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`, () => {
                    deleteArticleImages(articleId)
                        .then(() => {
                            if (deleteButton.parentNode) {
                                deleteButton.parentNode.removeChild(deleteButton);
                            }
                    // Also, if the management modal is open and for this article, refresh it or close it
                    const modal = document.querySelector('div[style*="z-index: 10000"]'); // Quick check if modal is open
                    if (modal && currentArticleIdForManagement === articleId) {
                        const listContainer = modal.querySelector('#githubImagesList');
                        if (listContainer) renderGitHubImagesList(articleId, listContainer);
                    }
                        });
                });
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –î–∑–µ–Ω–∞
            const zenCopyBtn = document.getElementById('zenCopyBtn');
            if (zenCopyBtn) {
                zenCopyBtn.parentNode.appendChild(deleteButton);
            } else {
                const zenCopyBtn2 = document.getElementById('zenCopyBtn2');
                if (zenCopyBtn2) {
                    zenCopyBtn2.parentNode.appendChild(deleteButton);
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –≤–Ω–µ—à–Ω–∏–π —Ö–æ—Å—Ç–∏–Ω–≥ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
        async function uploadImageToExternalHost(dataUrl, filename) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–∏—Å —Ö–æ—Å—Ç–∏–Ω–≥–∞
            // –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å GitHub –∏—Å–ø–æ–ª—å–∑—É–µ–º uploadImageToGitHub

            try {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID —Å—Ç–∞—Ç—å–∏
                const articleId = generateArticleId();

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ GitHub
                return await uploadImageToGitHub(dataUrl, filename, articleId);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);

                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ–º–æ-URL (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
                return `https://cdn.publikator.demo/img_${Date.now()}_${Math.random().toString(36).substr(2, 9)}/${filename}`;
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è dataURL –≤ Blob
        function dataURLtoBlob(dataURL) {
            return new Promise((resolve) => {
                const arr = dataURL.split(',');
                const mime = arr[0].match(/:(.*?);/)[1];
                const bstr = atob(arr[1]);
                let n = bstr.length;
                const u8arr = new Uint8Array(n);
                while (n--) {
                    u8arr[n] = bstr.charCodeAt(n);
                }
                resolve(new Blob([u8arr], { type: mime }));
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è HTML –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyHtmlToClipboard(html) {
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π div –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            tempDiv.innerHTML = html;
            document.body.appendChild(tempDiv);

            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Clipboard API
                if (navigator.clipboard && navigator.clipboard.write) {
                    const clipboardItem = new ClipboardItem({
                        'text/html': new Blob([html], { type: 'text/html' }),
                        'text/plain': new Blob([tempDiv.textContent || tempDiv.innerText || ''], { type: 'text/plain' })
                    });

                    navigator.clipboard.write([clipboardItem])
                        .catch(err => {
                            console.error('–û—à–∏–±–∫–∞ Clipboard API:', err);
                            fallbackCopyMethod(tempDiv);
                        });
                } else {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback –º–µ—Ç–æ–¥
                    fallbackCopyMethod(tempDiv);
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                fallbackCopyMethod(tempDiv);
            } finally {
                // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π div
                if (tempDiv.parentNode) {
                    tempDiv.parentNode.removeChild(tempDiv);
                }
            }
        }

        // Fallback –º–µ—Ç–æ–¥ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        function fallbackCopyMethod(element) {
            const range = document.createRange();
            range.selectNodeContents(element);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            let successful = false;
            try {
                successful = document.execCommand('copy');
                if (!successful) {
                   showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç —á–µ—Ä–µ–∑ execCommand. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é (Ctrl+C).', 'error');
                } else {
                   showNotification('–ö–æ–Ω—Ç–µ–Ω—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω (fallback –º–µ—Ç–æ–¥).', 'success');
                }
            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ fallback –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ fallback –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é (Ctrl+C).', 'error');
            }

            // –û—á–∏—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            if (window.getSelection) {
                window.getSelection().removeAllRanges();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏
        function showCopySuccess() {
            const successDiv = document.getElementById('copySuccess');
            if (successDiv) {
                successDiv.style.display = 'block';

                // –ò–∑–º–µ–Ω—è–µ–º —Å—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏
                const btn = document.getElementById('zenCopyBtn') || document.getElementById('zenCopyBtn2');
                if (btn) {
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –î–∑–µ–Ω–∞!';
                    btn.style.background = '#28a745';

                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.style.background = '';
                        successDiv.style.display = 'none';
                    }, 3000);
                }
            }
        }

        function publishContent() {
            if (!processedContent) {
                generatePreview();
                if (!processedContent) {
                    showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä!', 'error');
                    return;
                }
            }

            const loading = document.getElementById('loading');
            const publishResult = document.getElementById('publishResult');
            const publishedContentDiv = document.getElementById('publishedContent');
            const finalContentDiv = document.getElementById('finalContent');

            loading.style.display = 'block';
            publishResult.innerHTML = '';

            setTimeout(() => {
                finalContentDiv.innerHTML = processedContent;
                publishedContentDiv.style.display = 'block';

                window.publishedHtml = createFullHtmlPage(processedContent);

                loading.style.display = 'none';
                publishResult.innerHTML = `
                    <div class="publish-url">
                        <strong>‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!</strong><br><br>
                        <p style="color: rgba(255,255,255,0.9);">–í–∞—à–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∏–∂–µ –∏ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</p>
                    </div>
                `;

                setTimeout(() => {
                    publishedContentDiv.scrollIntoView({ behavior: 'smooth' });
                }, 500);
            }, 1500);
        }

        function downloadCurrentPage() {
            const htmlContent = window.publishedHtml;
            if (htmlContent) {
                const pageId = 'page_' + Date.now();
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `published_page_${pageId}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } else {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç!', 'error');
            }
        }

        function createFullHtmlPage(content) {
            return `<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
    <style>
        body { font-family: 'Times New Roman', Times, serif; margin: 20px auto; max-width: 800px; padding: 0 20px; line-height: 1.6; color: #333; }
        figure { margin: 20px 0; text-align: center; }
        img { max-width: 100%; height: auto; display: block; margin: 0 auto; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        p { margin: 1em 0; }
        figcaption { font-style: italic; color: #555; text-align: center; margin-top: 8px; font-size: 0.9em; }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–æ–≤ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π, –µ—Å–ª–∏ –æ–Ω–∏ –ø–æ–ø–∞–¥—É—Ç –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π HTML */
        div[style*="background: #ffebee"] { border: 1px solid #c62828; padding: 10px; margin: 10px 0; border-radius: 4px; }
    </style>
</head>
<body>
    ${content}
</body>
</html>`;
        }

        function clearAll() {
            confirmAction("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—Å–µ –æ—á–∏—Å—Ç–∏—Ç—å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.", () => {
                document.getElementById('textEditor').value = '';
                document.getElementById('previewContent').innerHTML = '<p style="text-align: center; color: #999; font-style: italic;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä"</p>';
                document.getElementById('imagesList').innerHTML = '';
                const publishResult = document.getElementById('publishResult');
                if(publishResult) publishResult.innerHTML = '';
                const publishedContent = document.getElementById('publishedContent');
                if(publishedContent) publishedContent.style.display = 'none';

                uploadedImages.clear();
                imageUrlMap.clear();
                processedContent = '';
                window.publishedHtml = '';

                // –£–¥–∞–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                const deleteButtons = document.querySelectorAll('button[id^="delete-images-"]');
                deleteButtons.forEach(btn => btn.remove());
                showNotification('–í—Å–µ –ø–æ–ª—è –æ—á–∏—â–µ–Ω—ã.', 'info', 2000);
            });
        }

        function copyToClipboard() {
             if (window.publishedHtml) {
                navigator.clipboard.writeText(window.publishedHtml).then(() => {
                    showNotification('HTML –∫–æ–¥ –ø–æ–ª–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
                }).catch(err => {
                    showNotification('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è HTML: ' + err, 'error');
                    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è HTML:', err);
                });
            } else {
                showNotification('–°–Ω–∞—á–∞–ª–∞ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å HTML –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.', 'error');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub (–±–µ–∑ —Ç–æ–∫–µ–Ω–∞)
            const savedConfig = JSON.parse(localStorage.getItem('githubConfig') || '{}');
            if (savedConfig.owner) githubConfig.owner = savedConfig.owner;
            if (savedConfig.repo) githubConfig.repo = savedConfig.repo;
            if (savedConfig.branch) githubConfig.branch = savedConfig.branch;
            if (savedConfig.imagesPath) githubConfig.imagesPath = savedConfig.imagesPath;
            
            // –í–∞–∂–Ω–æ: –¢–æ–∫–µ–Ω –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ localStorage. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—É–¥–µ—Ç –µ–≥–æ –≤–≤–µ—Å—Ç–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
            // –û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ –µ—Å—Ç—å owner –∏ repo, –º–æ–∂–Ω–æ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω —É–∂–µ –µ—Å—Ç—å –≤ githubConfig (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–µ–∞–Ω—Å–∞ –≤ —Ç–æ–π –∂–µ –≤–∫–ª–∞–¥–∫–µ)
            // –ù–æ –ª—É—á—à–µ –≤—Å–µ–≥–æ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É/–ø—Ä–æ–≤–µ—Ä–∫—É, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
            // For now, validateGitHubConfig(false) could be called to silently check and show manage button if config is valid and token happens to be there.
            // validateGitHubConfig(false); // Silently check and update UI if possible.

            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            const fileUploadSection = document.querySelector('.file-upload');
            if (fileUploadSection) {
                const setupButton = document.createElement('div');
                setupButton.className = 'file-input-wrapper';
                setupButton.style.background = 'linear-gradient(135deg, #333 0%, #666 100%)';
                setupButton.innerHTML = '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub';
                setupButton.style.cursor = 'pointer';
                setupButton.addEventListener('click', setupGitHub);
                fileUploadSection.appendChild(setupButton);
            }
        });
    </script>
</body>
</html>
